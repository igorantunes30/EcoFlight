import socket
import requests
from PIL import Image
from io import BytesIO

# Configurações do servidor (notebook)
NOTEBOOK_IP = '192.168.137.1'  # Substitua pelo IP do notebook
NOTEBOOK_PORT = 8080  # Porta que o servidor do notebook está escutando

# URL do stream da câmera do celular
CAMERA_URL = 'http://192.168.137.138.4747/shot.jpg'  # Substitua pelo IP da câmera IP do seu celular

def capture_and_send_image():
    while True:
        try:
            # Fazer a requisição HTTP para obter a imagem da câmera do celular
            response = requests.get(CAMERA_URL)
            image = Image.open(BytesIO(response.content))

            # Salvar a imagem temporariamente
            image.save('captured_image.jpg')

            # Ler a imagem capturada
            with open('captured_image.jpg', 'rb') as image_file:
                image_data = image_file.read()

            # Conectar ao notebook e enviar a imagem
            client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            client_socket.connect((NOTEBOOK_IP, NOTEBOOK_PORT))
            client_socket.sendall(image_data)
            client_socket.close()
            print("Imagem enviada com sucesso!")

        except Exception as e:
            print(f"Erro ao capturar ou enviar imagem: {e}")

if __name__ == '__main__':
    capture_and_send_image()
