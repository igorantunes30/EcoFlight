import cv2
import socket
import time

# Configurações do servidor (notebook)
NOTEBOOK_IP = '192.168.0.119'  # Substitua pelo IP do notebook
NOTEBOOK_PORT = 8080  # Porta que o servidor do notebook está escutando

# URL do stream de vídeo do DroidCam
CAMERA_URL = 'http://192.168.0.134:4747/video'  # URL do vídeo do DroidCam

def capture_and_send_image():
    # Abrir a conexão com o stream de vídeo
    cap = cv2.VideoCapture(CAMERA_URL)

    if not cap.isOpened():
        print("Erro ao acessar a câmera do celular.")
        return

    while True:
        # Capturar um frame do vídeo
        ret, frame = cap.read()
        if not ret:
            print("Falha ao capturar frame do vídeo.")
            break

        # Salvar o frame como imagem temporária
        image_path = 'captured_image.jpg'
        cv2.imwrite(image_path, frame)

        # Ler a imagem capturada e enviar para o notebook
        try:
            with open(image_path, 'rb') as image_file:
                image_data = image_file.read()

            # Conectar ao notebook e enviar a imagem
            client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            client_socket.connect((NOTEBOOK_IP, NOTEBOOK_PORT))
            client_socket.sendall(image_data)
            client_socket.close()
            print("Imagem enviada com sucesso!")

        except Exception as e:
            print(f"Erro ao capturar ou enviar imagem: {e}")

        # Aguardar 1 segundo antes de capturar o próximo frame
        time.sleep(1)

    cap.release()

if __name__ == '__main__':
    capture_and_send_image()
