#include <WiFi.h>
#include <WiFiClient.h>
#include <WiFiServer.h>

const char* ssid = "ESP32_AP";  // Nome da rede Wi-Fi (SSID)
const char* password = "12345678";  // Senha da rede Wi-Fi

WiFiServer server(80);  // Inicia o servidor na porta 80 (HTTP)

void setup() {
  Serial.begin(115200);
  
  // Configura o ESP32 como Access Point
  WiFi.softAP(ssid, password);
  Serial.println("Ponto de Acesso iniciado");
  Serial.print("Endereço IP: ");
  Serial.println(WiFi.softAPIP());

  // Inicia o servidor
  server.begin();
  Serial.println("Servidor iniciado");
}

void loop() {
  WiFiClient client = server.available();
  
  if (client) {
    Serial.println("Cliente conectado, recebendo imagem...");
    uint8_t buffer[1024];  // Buffer para receber dados da imagem
    
    // Enquanto o cliente estiver conectado, recebemos os dados
    while (client.connected()) {
      int bytesRead = client.read(buffer, sizeof(buffer));  // Lê os dados da imagem
      if (bytesRead > 0) {
        Serial.print("Recebido: ");
        Serial.print(bytesRead);
        Serial.println(" bytes");
        
        // Envia a imagem recebida para o Serial (ou algum outro processamento)
        Serial.write(buffer, bytesRead);
      } else {
        break;  // Sai do loop se não houver mais dados
      }
    }
    client.stop();  // Desconecta o cliente após receber a imagem
    Serial.println("Cliente desconectado");
  }
}
