import socket
import time

# Caminho da imagem armazenada no Raspberry Pi
IMAGE_PATH = '/home/lprad/EcoFlight/oip_comp.jpeg'

# IP e porta do ESP32
ESP32_IP = '192.168.4.1'  # IP do ESP32 no modo Access Point
ESP32_PORT = 80

# Função para ler e enviar a imagem armazenada
def send_image():
    # Abre o arquivo da imagem armazenada
    with open(IMAGE_PATH, 'rb') as image_file:
        # Conectando ao ESP32
        client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        client_socket.connect((ESP32_IP, ESP32_PORT))

        # Enviando a imagem em pacotes
        while True:
            chunk = image_file.read(1024)  # Lê 1024 bytes por vez
            if not chunk:
                break
            client_socket.send(chunk)

        # Finaliza a transmissão
        client_socket.close()

# Loop principal
while True:
    send_image()
    time.sleep(1)  # Envia a imagem armazenada a cada 1 segundo
